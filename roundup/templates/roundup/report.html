{% load report_extras %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>{{ league_name }} – Week {{ week }} Roundup</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #dbeafe;
      --secondary: #8b5cf6;
      --accent: #06b6d4;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    }

    * {
      box-sizing: border-box;
    }

    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
      margin: 0; 
      padding: 20px; 
      color: var(--gray-800); 
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      min-height: 100vh;
      line-height: 1.6;
    }

    .grid { 
      display: grid; 
      grid-template-columns: 1fr 2.3fr 1.2fr; 
      grid-template-rows: auto auto 1fr; 
      gap: 24px; 
      min-height: calc(100vh - 40px);
      max-width: 1400px;
      margin: 0 auto;
    }

    header { 
      grid-column: 1 / -1; 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      gap: 16px; 
      flex-wrap: wrap;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 24px 32px;
      border-radius: 16px;
      box-shadow: var(--shadow-xl);
      margin-bottom: 8px;
    }

    .card { 
      background: white; 
      border: 1px solid var(--gray-200); 
      border-radius: 16px; 
      padding: 24px; 
      box-shadow: var(--shadow-lg);
      transition: all 0.2s ease;
      border: none;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .banner { 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: white; 
      border: none; 
      box-shadow: var(--shadow-xl);
    }

    h1 { 
      margin: 0; 
      font-size: 28px; 
      font-weight: 800; 
      letter-spacing: -0.025em;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h2 { 
      margin: 0 0 16px; 
      font-size: 20px; 
      font-weight: 700; 
      color: var(--gray-800);
      letter-spacing: -0.025em;
    }

    ul { 
      margin: 12px 0; 
      padding-left: 20px; 
    }

    table { 
      width: 100%; 
      border-collapse: collapse; 
    }

    .scores { 
      width: 100%; 
      table-layout: auto; 
      font-variant-numeric: tabular-nums; 
    }

    th, td { 
      padding: 16px 12px; 
      border-bottom: 1px solid var(--gray-200); 
      vertical-align: middle; 
    }

    th { 
      text-align: left; 
      color: var(--gray-600); 
      font-weight: 600; 
      font-size: 12px; 
      text-transform: uppercase; 
      letter-spacing: .05em;
      background: var(--gray-50);
      border-bottom: 2px solid var(--gray-200);
    }

    tbody tr:nth-child(odd) { 
      background: var(--gray-50); 
    }

    tbody tr:nth-child(even) {
      background: white;
    }

    tbody tr:hover {
      background: var(--primary-light);
      transform: scale(1.01);
      transition: all 0.2s ease;
    }

    tbody tr.close { 
      background: #fef3c7; 
      border-left: 4px solid var(--warning);
    }

    .standings { 
      table-layout: fixed; 
    }

    .standings tr.playoff { 
      background: #ecfdf5; 
    }

    .standings tr.cutoff > td { 
      border-bottom: 3px solid var(--success); 
      font-weight: 600;
    }

    .standings th, .standings td { 
      white-space: nowrap; 
    }

    .standings th:nth-child(2), .standings td:nth-child(2) { 
      width: 88px; 
      text-align: center; 
    }

    .standings th:nth-child(3), .standings td:nth-child(3) { 
      width: 84px; 
      text-align: right; 
    }

    .standings td:nth-child(2), .standings td:nth-child(3) { 
      font-size: 14px; 
      line-height: 1.25; 
    }

    .standings td:first-child { 
      white-space: normal; 
      overflow: visible; 
      text-overflow: initial; 
      font-size: 14px; 
      line-height: 1.25; 
    }

    .muted { 
      color: var(--gray-500); 
      font-size: 13px; 
    }

    .two-col { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 16px; 
    }

    .team-cell-home { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      justify-content: flex-end; 
    }

    .team-cell-away { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      justify-content: flex-start; 
    }

    .team-cell img { 
      width: 24px; 
      height: 24px; 
      border-radius: 8px; 
      object-fit: cover; 
      background: white; 
      border: 2px solid var(--gray-200); 
      box-shadow: var(--shadow-sm);
    }

    .score-col { 
      width: 120px; 
      text-align: center; 
      font-size: 32px; 
      font-weight: 700;
    }

    .score-col strong { 
      color: var(--success); 
      text-shadow: 0 2px 4px rgba(16,185,129,0.2);
    }

    .vs-col { 
      width: 40px; 
      text-align: center; 
      color: var(--gray-500); 
      font-weight: 600; 
      font-size: 14px;
    }

    .logo-col { 
      width: 28px; 
      text-align: center; 
    }

    .logo-img { 
      width: 24px; 
      height: 24px; 
      border-radius: 8px; 
      object-fit: cover; 
      background: white; 
      border: 2px solid var(--gray-200); 
      box-shadow: var(--shadow-sm);
    }

    .name-col { 
      width: 200px; 
      font-weight: 600; 
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .pill { 
      display: inline-block; 
      padding: 4px 12px; 
      border-radius: 999px; 
      background: var(--primary-light); 
      color: var(--primary-dark); 
      font-size: 12px; 
      font-weight: 600; 
      box-shadow: var(--shadow-sm);
    }

    .move { 
      font-size: 12px; 
      margin-left: 8px; 
      padding: 2px 6px;
      border-radius: 6px;
      font-weight: 600;
    }

    .move.up { 
      color: var(--success); 
      background: #ecfdf5;
    }

    .move.down { 
      color: var(--danger); 
      background: #fef2f2;
    }

    .nav { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
    }

    .btn { 
      display: inline-flex; 
      align-items: center; 
      gap: 8px; 
      padding: 10px 16px; 
      border: 2px solid rgba(255,255,255,0.3); 
      border-radius: 12px; 
      background: rgba(255,255,255,0.1); 
      color: white; 
      text-decoration: none; 
      font-size: 14px; 
      font-weight: 600;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    .btn:hover { 
      background: rgba(255,255,255,0.2); 
      border-color: rgba(255,255,255,0.5);
      transform: translateY(-1px);
    }

    .btn.disabled { 
      pointer-events: none; 
      opacity: 0.5; 
    }

    .loading { 
      color: var(--gray-600); 
      font-style: italic; 
    }

    .hidden { 
      display: none; 
    }

    .spinner { 
      width: 20px; 
      height: 20px; 
      border: 3px solid var(--gray-300); 
      border-top-color: var(--primary); 
      border-radius: 50%; 
      display: inline-block; 
      animation: spin 1s linear infinite; 
      vertical-align: text-bottom; 
      margin-right: 8px; 
    }

    @keyframes spin { 
      from { transform: rotate(0deg);} 
      to { transform: rotate(360deg);} 
    }

    .table-sticky thead th { 
      position: sticky; 
      top: 0; 
      background: var(--gray-50); 
      z-index: 1; 
    }

    .pts-col { 
      width: 64px; 
      text-align: center; 
      font-variant-numeric: tabular-nums; 
      font-size: 20px; 
    }

         /* New Booms/Busts Card Layout */
     .bb-grid {
       display: grid;
       gap: 16px;
     }
     
     .bb-position-card {
       background: var(--gray-50);
       border: 1px solid var(--gray-200);
       border-radius: 12px;
       padding: 16px;
       transition: all 0.2s ease;
     }
     
     .bb-position-card:hover {
       transform: translateY(-2px);
       box-shadow: var(--shadow-md);
       border-color: var(--gray-300);
     }
     
     .bb-position-header {
       font-size: 14px;
       font-weight: 700;
       color: var(--primary);
       text-transform: uppercase;
       letter-spacing: 0.05em;
       text-align: center;
       margin-bottom: 16px;
       padding: 8px 12px;
       background: white;
       border-radius: 8px;
       border: 1px solid var(--gray-200);
     }
     
     .bb-players {
       display: grid;
       grid-template-columns: 1fr 1fr;
       gap: 12px;
     }
     
     .bb-player {
       background: white;
       border-radius: 10px;
       padding: 12px;
       border: 1px solid var(--gray-200);
       transition: all 0.2s ease;
       position: relative;
     }
     
     .bb-player:hover {
       transform: translateY(-1px);
       box-shadow: var(--shadow-sm);
     }
     
     .bb-player.boom {
       border-left: 4px solid var(--success);
     }
     
     .bb-player.bust {
       border-left: 4px solid var(--danger);
     }
     
     .bb-player-header {
       display: flex;
       align-items: center;
       gap: 8px;
       margin-bottom: 8px;
     }
     

     
     .bb-player-type {
       font-size: 11px;
       font-weight: 600;
       text-transform: uppercase;
       letter-spacing: 0.05em;
       padding: 2px 6px;
       border-radius: 4px;
     }
     
     .bb-player.boom .bb-player-type {
       background: #ecfdf5;
       color: var(--success);
     }
     
     .bb-player.bust .bb-player-type {
       background: #fef2f2;
       color: var(--danger);
     }
     
     .bb-player-content {
       margin-bottom: 8px;
     }
     
     .bb-player-name {
       font-weight: 600;
       font-size: 13px;
       color: var(--gray-800);
       margin-bottom: 2px;
       line-height: 1.3;
     }
     
     .bb-player-team {
       font-size: 11px;
       color: var(--gray-600);
       margin-bottom: 4px;
     }
     
     .bb-player-points {
       font-weight: 700;
       font-size: 16px;
       color: var(--success);
     }
     
     .bb-player.bust .bb-player-points {
       color: var(--danger);
     }
     
     .bb-nfl-logo {
       position: absolute;
       top: 8px;
       right: 8px;
       width: 24px;
       height: 24px;
       border-radius: 6px;
       border: 1px solid var(--gray-200);
       background: white;
     }
     
     .bb-no-data {
       text-align: center;
       padding: 24px;
       color: var(--gray-500);
       font-style: italic;
     }
     
     /* Legacy table styles (keeping for mobile) */
     .bb-table { 
       width: 100%; 
       border-collapse: collapse; 
     }
 
     .bb-table th + th, .bb-table td + td { 
       border-left: 1px solid var(--gray-200); 
     }
 
     .bb-table .logo-col { 
       width: 36px; 
       text-align: center; 
     }
 
     .bb-table .pts-col { 
       width: 80px; 
       font-size: 22px; 
     }
 
     .bb-logo { 
       width: 28px; 
       height: 28px; 
       border-radius: 8px;
       border: 2px solid var(--gray-200);
       box-shadow: var(--shadow-sm);
     }
 
     .bb-name-text strong { 
       font-size: 14px; 
       font-weight: 700; 
     }
 
     .bb-sub { 
       font-size: 12px !important; 
     }

    .section-divider { 
      border-top: 2px solid var(--gray-200); 
      margin: 16px 0 20px; 
    }

    .awards { 
      list-style: none; 
      padding: 0; 
      margin: 0; 
      display: grid; 
      grid-template-columns: 1fr; 
      gap: 12px; 
    }

    .award { 
      display: flex; 
      align-items: flex-start; 
      gap: 12px; 
      border: 1px solid var(--gray-200); 
      background: var(--gray-50); 
      border-radius: 12px; 
      padding: 16px; 
      transition: all 0.2s ease;
    }

        .award:hover {
      background: white;
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }
    
    .award-icon { 
      width: 32px; 
      height: 32px; 
      border-radius: 50%; 
      display: inline-flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 16px; 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: white; 
      font-weight: 700; 
      flex-shrink: 0; 
      box-shadow: var(--shadow); 
    }
    
         /* Desktop Scores - Card Layout */
     .desktop-scores {
       display: grid;
       gap: 16px;
     }
     
     .score-matchup-card {
       background: var(--gray-50);
       border: 1px solid var(--gray-200);
       border-radius: 16px;
       padding: 20px;
       display: grid;
       grid-template-columns: 1fr auto 1fr;
       gap: 20px;
       align-items: center;
       transition: all 0.2s ease;
     }
     
     .score-matchup-card:hover {
       transform: translateY(-2px);
       box-shadow: var(--shadow-md);
       border-color: var(--gray-300);
     }
     
     .score-team {
       display: flex;
       flex-direction: column;
       align-items: center;
       text-align: center;
       padding: 16px;
       background: white;
       border-radius: 12px;
       border: 2px solid var(--gray-200);
       transition: all 0.2s ease;
     }
     
     .score-team.winner {
       border-color: var(--success);
       background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
       box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
     }
     
     .score-team.winner:hover {
       transform: translateY(-1px);
       box-shadow: 0 6px 16px rgba(16, 185, 129, 0.2);
     }
     
     .team-info {
       margin-bottom: 12px;
     }
     
     .team-name {
       font-weight: 700;
       font-size: 16px;
       color: var(--gray-800);
       margin-bottom: 4px;
       line-height: 1.3;
     }
     
     .team-record {
       font-size: 12px;
       color: var(--gray-500);
       font-weight: 500;
     }
     
     .team-score {
       font-size: 28px;
       font-weight: 800;
       color: var(--gray-600);
       line-height: 1;
     }
     
     .winner-score {
       color: var(--success);
       text-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
     }
     
     .score-vs {
       display: flex;
       flex-direction: column;
       align-items: center;
       gap: 8px;
     }
     
     .vs-text {
       font-size: 14px;
       font-weight: 600;
       color: var(--gray-500);
       text-transform: uppercase;
       letter-spacing: 0.05em;
     }
     
     .winner-indicator {
       font-size: 20px;
       animation: bounce 2s infinite;
     }
     
     @keyframes bounce {
       0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
       40% { transform: translateY(-4px); }
       60% { transform: translateY(-2px); }
     }
     
     /* Hide mobile layouts on desktop */
     .mobile-scores, .mobile-standings, .mobile-bb {
       display: none;
     }
     
     /* Desktop Standings - Card Layout */
     .desktop-standings {
       display: grid;
       gap: 12px;
     }
     
     .standing-team-card {
       background: white;
       border: 1px solid var(--gray-200);
       border-radius: 12px;
       padding: 16px;
       display: grid;
       grid-template-columns: auto 1fr auto;
       gap: 16px;
       align-items: center;
       transition: all 0.2s ease;
     }
     
     .standing-team-card:hover {
       transform: translateY(-1px);
       box-shadow: var(--shadow-sm);
       border-color: var(--gray-300);
     }
     
     .standing-team-card.playoff {
       background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
       border-color: var(--success);
       box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
     }
     
     .standing-team-card.playoff:hover {
       box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
     }
     
     .standing-team-card.cutoff {
       border-bottom: 3px dotted var(--success);
       background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
       border-color: var(--warning);
     }
     
     .standing-rank {
       display: flex;
       flex-direction: column;
       align-items: center;
       gap: 4px;
     }
     
     .rank-number {
       font-size: 18px;
       font-weight: 800;
       color: var(--primary);
       line-height: 1;
     }
     
     .playoff-badge {
       font-size: 14px;
       animation: pulse 2s infinite;
     }
     
     @keyframes pulse {
       0%, 100% { opacity: 1; }
       50% { opacity: 0.7; }
     }
     
     .standing-team-info {
       display: flex;
       flex-direction: column;
       gap: 4px;
     }
     
     .standing-team-info .team-name {
       font-weight: 600;
       font-size: 14px;
       color: var(--gray-800);
       line-height: 1.3;
     }
     
     .movement-indicator {
       font-size: 11px;
       font-weight: 600;
       padding: 2px 6px;
       border-radius: 4px;
       display: inline-block;
       width: fit-content;
     }
     
     .movement-indicator.up {
       background: #ecfdf5;
       color: var(--success);
     }
     
     .movement-indicator.down {
       background: #fef2f2;
       color: var(--danger);
     }
     
     .standing-stats {
       display: flex;
       flex-direction: column;
       align-items: flex-end;
       gap: 4px;
     }
     
     .record-badge {
       background: var(--gray-100);
       color: var(--gray-700);
       padding: 4px 8px;
       border-radius: 6px;
       font-size: 12px;
       font-weight: 600;
       text-align: center;
       min-width: 60px;
     }
     
     .points-display {
       font-size: 16px;
       font-weight: 700;
       color: var(--gray-800);
       line-height: 1;
     }
     
     /* Player Highlights Card */
     .highlights-card {
       background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
       border: 2px solid var(--accent);
       box-shadow: 0 8px 25px rgba(6, 182, 212, 0.15);
     }
     
     .highlights-card:hover {
       transform: translateY(-2px);
       box-shadow: 0 12px 35px rgba(6, 182, 212, 0.25);
     }
     
     /* Weekly Incentive Card */
     .incentive-card {
       background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
       border: 2px solid var(--warning);
       box-shadow: 0 8px 25px rgba(245, 158, 11, 0.15);
     }
     
     .incentive-card:hover {
       transform: translateY(-3px);
       box-shadow: 0 12px 35px rgba(245, 158, 11, 0.25);
     }
     
     .incentive-content {
       display: grid;
       gap: 20px;
     }
     
     .incentive-section {
       display: flex;
       flex-direction: column;
       gap: 8px;
     }
     
     .incentive-label {
       font-size: 12px;
       font-weight: 600;
       text-transform: uppercase;
       letter-spacing: 0.05em;
       color: var(--warning);
     }
     
     .incentive-title, .incentive-next {
       font-size: 16px;
       font-weight: 600;
       color: var(--gray-800);
       line-height: 1.4;
     }
     
     .incentive-winner {
       display: flex;
       align-items: center;
       gap: 8px;
     }
     
     .winner-text {
       font-size: 18px;
       font-weight: 700;
       color: var(--success);
       text-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
     }
     
     .pending-text {
       font-size: 16px;
       font-weight: 600;
       color: var(--gray-600);
       font-style: italic;
     }
     
     /* Ensure tables are visible on desktop */
     .scores, .standings, .bb-table {
       display: table;
     }

    .award-body { 
      display: grid; 
      gap: 4px; 
    }

    .award-title { 
      font-weight: 700; 
      font-size: 14px; 
      color: var(--gray-800);
    }

    .award-text { 
      font-size: 13px; 
      color: var(--gray-600); 
    }

    /* Responsive design */
    @media (max-width: 1200px) {
      .grid {
        grid-template-columns: 1fr 2fr 1fr;
        gap: 20px;
      }
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto auto auto;
        gap: 20px;
      }
      
      header {
        flex-direction: column;
        text-align: center;
        gap: 16px;
        padding: 20px 24px;
      }
      
      .nav {
        justify-content: center;
        flex-wrap: wrap;
        gap: 8px;
      }
      
      .btn {
        padding: 8px 14px;
        font-size: 13px;
      }
      
      .card {
        padding: 20px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      h2 {
        font-size: 18px;
        margin-bottom: 12px;
      }
      
      .score-col {
        font-size: 28px;
        width: 100px;
      }
      
      .vs-col {
        width: 32px;
        font-size: 12px;
      }
      
      .name-col {
        font-size: 14px;
      }
      
      .standings th, .standings td {
        font-size: 13px;
        padding: 12px 8px;
      }
      
      .award {
        padding: 12px;
      }
      
      .award-icon {
        width: 28px;
        height: 28px;
        font-size: 14px;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 12px;
        overflow-x: hidden;
      }
      
      .grid {
        display: block;
        gap: 0;
        min-height: auto;
        max-width: 100%;
      }
      
      header {
        padding: 16px 20px;
        margin-bottom: 16px;
        border-radius: 12px;
      }
      
      h1 {
        font-size: 20px;
        line-height: 1.2;
      }
      
      .nav {
        gap: 8px;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }
      
      .btn {
        padding: 8px 16px;
        font-size: 14px;
        border-radius: 8px;
        width: 100%;
        justify-content: center;
        margin-bottom: 8px;
        max-width: 200px;
        box-sizing: border-box;
      }
      
      .card {
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
        max-width: 100%;
        box-sizing: border-box;
        width: 100%;
      }
      
                                                       /* Mobile: Hide tables and desktop layouts, show simplified layouts */
         .scores, .standings, .bb-table, .bb-grid, .desktop-scores, .desktop-standings {
           display: none !important;
         }
      
      /* Mobile scores - card-based layout */
      .mobile-scores {
        display: block;
      }
      
      .mobile-score-card {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        text-align: center;
      }
      
      .mobile-score-teams {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }
      
      .mobile-team {
        flex: 1;
        text-align: center;
      }
      
      .mobile-team-name {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
      }
      
      .mobile-team-record {
        font-size: 12px;
        color: var(--gray-500);
      }
      
      .mobile-score {
        font-size: 24px;
        font-weight: 700;
        color: var(--success);
      }
      
      .mobile-score.loser {
        color: var(--gray-600);
      }
      
      .mobile-vs {
        font-size: 12px;
        color: var(--gray-500);
        margin: 0 12px;
        font-weight: 600;
      }
      
      /* Mobile standings - list layout */
      .mobile-standings {
        display: block;
      }
      
      .mobile-standing-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px;
        border-bottom: 1px solid var(--gray-200);
        background: white;
      }
      
      .mobile-standing-item:last-child {
        border-bottom: none;
      }
      
      .mobile-standing-item.playoff {
        background: #ecfdf5;
      }
      
      .mobile-standing-item.cutoff {
        border-bottom: 3px solid var(--success);
        font-weight: 600;
      }
      
      .mobile-standing-rank {
        font-weight: 700;
        color: var(--primary);
        margin-right: 12px;
        min-width: 24px;
      }
      
      .mobile-standing-team {
        flex: 1;
        font-weight: 600;
      }
      
      .mobile-standing-stats {
        text-align: right;
        font-size: 12px;
      }
      
      .mobile-standing-record {
        font-weight: 600;
        margin-bottom: 2px;
      }
      
      .mobile-standing-pf {
        color: var(--gray-600);
      }
      
      /* Mobile booms/busts - card layout */
      .mobile-bb {
        display: block;
      }
      
      .mobile-bb-position {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
      }
      
      .mobile-bb-position-title {
        font-weight: 700;
        font-size: 14px;
        color: var(--primary);
        margin-bottom: 12px;
        text-align: center;
        text-transform: uppercase;
      }
      
      .mobile-bb-players {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      
      .mobile-bb-player {
        text-align: center;
        padding: 12px;
        background: white;
        border-radius: 8px;
        border: 1px solid var(--gray-200);
      }
      
      .mobile-bb-player-name {
        font-weight: 600;
        font-size: 13px;
        margin-bottom: 4px;
      }
      
      .mobile-bb-player-team {
        font-size: 11px;
        color: var(--gray-600);
        margin-bottom: 8px;
      }
      
      .mobile-bb-player-points {
        font-size: 18px;
        font-weight: 700;
        color: var(--success);
      }
      
      .mobile-bb-player.bust .mobile-bb-player-points {
        color: var(--danger);
      }
      
      /* Mobile awards */
      .award {
        padding: 12px;
        gap: 8px;
      }
      
      .award-icon {
        width: 24px;
        height: 24px;
        font-size: 12px;
      }
      
      .award-title {
        font-size: 13px;
      }
      
      .award-text {
        font-size: 12px;
      }
      
      .move {
        font-size: 11px;
        margin-left: 6px;
        padding: 1px 4px;
      }
      
      /* Mobile spacing */
      .section-divider {
        margin: 12px 0 16px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      
      .grid {
        gap: 0;
      }
      
      header {
        padding: 12px 16px;
        margin-bottom: 12px;
      }
      
      h1 {
        font-size: 18px;
      }
      
      .card {
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 12px;
      }
      
      .score-col {
        font-size: 18px;
        width: 50px;
        min-width: 50px;
      }
      
      .vs-col {
        width: 20px;
        font-size: 9px;
        min-width: 20px;
      }
      
      .name-col {
        font-size: 11px;
      }
      
      .scores, .standings, .bb-table {
        font-size: 10px;
      }
      
      .scores td, .standings td, .bb-table td {
        padding: 6px 3px;
      }
      
      .bb-table .pts-col {
        width: 40px;
        font-size: 14px;
        min-width: 40px;
      }
      
      .award {
        padding: 8px;
      }
      
      .award-icon {
        width: 20px;
        height: 20px;
        font-size: 10px;
      }
      
      .btn {
        padding: 6px 12px;
        font-size: 13px;
        margin-bottom: 6px;
      }

      /* Mobile spacing */
      .section-divider {
          margin: 12px 0 16px;
      }
        
        /* Mobile highlights and incentive cards */
        .highlights-card, .incentive-card {
          margin-top: 16px;
          padding: 16px;
      }
        
        .incentive-content {
          gap: 16px;
      }
        
        .incentive-title, .incentive-next {
          font-size: 14px;
      }
        
        .winner-text {
          font-size: 16px;
      }
        
        .pending-text {
          font-size: 14px;
      }

      .points-display {
       font-size: 16px;
       font-weight: 700;
       color: var(--gray-800);
       line-height: 1;
     }
     
     /* Player Highlights Card */
     .highlights-card {
       background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
       border: 2px solid var(--accent);
       box-shadow: 0 8px 25px rgba(6, 182, 212, 0.15);
     }
     
     .highlights-card:hover {
       transform: translateY(-2px);
       box-shadow: 0 12px 35px rgba(6, 182, 212, 0.25);
     }
     
     /* Weekly Incentive Card */
     .incentive-card {
       background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
       border: 2px solid var(--warning);
       box-shadow: 0 8px 25px rgba(245, 158, 11, 0.15);
     }
     
     .incentive-card:hover {
       transform: translateY(-3px);
       box-shadow: 0 12px 35px rgba(245, 158, 11, 0.25);
     }
     
     .incentive-content {
       display: grid;
       gap: 20px;
     }
     
     .incentive-section {
       display: flex;
       flex-direction: column;
       gap: 8px;
     }
     
     .incentive-label {
       font-size: 12px;
       font-weight: 600;
       text-transform: uppercase;
       letter-spacing: 0.05em;
       color: var(--warning);
     }
     
     .incentive-title, .incentive-next {
       font-size: 16px;
       font-weight: 600;
       color: var(--gray-800);
       line-height: 1.4;
     }
     
     .incentive-winner {
       display: flex;
       align-items: center;
       gap: 8px;
     }
     
     .winner-text {
       font-size: 18px;
       font-weight: 700;
       color: var(--success);
       text-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
     }
     
     .pending-text {
       font-size: 16px;
       font-weight: 600;
       color: var(--gray-600);
       font-style: italic;
     }
     
    }
  </style>
</head>
<body>
  <div class="grid">
    <header>
      <div>
        <h1>{{ league_name }} – Week {{ week }} Roundup</h1>
      </div>
      <div class="nav">
        <a class="btn" href="{% url 'homepage' %}">🏠 Home</a>
        {% if prev_disabled %}
          <span class="btn disabled">◀ Previous</span>
        {% else %}
          <a class="btn" href="{% url 'weekly_report' year=year week=prev_week %}">◀ Previous</a>
        {% endif %}
        {% if next_disabled %}
          <span class="btn disabled">Next ▶</span>
        {% else %}
          <a class="btn" href="{% url 'weekly_report' year=year week=next_week %}">Next ▶</a>
        {% endif %}
      </div>
    </header>

    <section class="card" style="grid-column: 1 / -1; grid-row: 2;">
      <h2>Overview</h2>
      <p id="overview">
        <span class="spinner" id="overview-spinner"></span>
        <span class="loading">Loading AI overview…</span>
      </p>
    </section>

    <!-- Center: Weekly Scores (fills remaining height) -->
    <section class="card" id="scores-card" style="grid-column: 2; grid-row: 3;">
      <h2 style="text-align:center;">Weekly Scores</h2>
      
      <!-- Desktop Scores - Card Layout -->
      <div class="desktop-scores">
        {% for m in scoreboard %}
        <div class="score-matchup-card">
          <div class="score-team home-team {% if m.winner == m.home_team %}winner{% endif %}">
            <div class="team-info">
              <div class="team-name">{{ m.home_team }}</div>
              {% if m.home_record %}<div class="team-record">{{ m.home_record }}</div>{% endif %}
            </div>
            <div class="team-score {% if m.winner == m.home_team %}winner-score{% endif %}">
              {{ m.home_score }}
            </div>
          </div>
          
          <div class="score-vs">
            <div class="vs-text">vs</div>
            {% if m.winner %}
              <div class="winner-indicator">🏆</div>
            {% endif %}
          </div>
          
          <div class="score-team away-team {% if m.winner == m.away_team %}winner{% endif %}">
            <div class="team-info">
              <div class="team-name">{{ m.away_team }}</div>
              {% if m.away_record %}<div class="team-record">{{ m.away_record }}</div>{% endif %}
            </div>
            <div class="team-score {% if m.winner == m.away_team %}winner-score{% endif %}">
              {{ m.away_score }}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      
      <!-- Legacy table for fallback -->
      <table class="scores" id="scores-table" style="display: none;">
        <tbody>
          {% for m in scoreboard %}
          <tr>
            <td class="name-col">
              <div class="team-cell-home">
                <span>{{ m.home_team }}{% if m.home_record %} <span class="muted">({{ m.home_record }})</span>{% endif %}</span>
              </div>
            </td>
            <td class="score-col">
              {% if m.winner == m.home_team %}
                <strong>{{ m.home_score }}</strong>
              {% else %}
                <span>{{ m.home_score }}</span>
              {% endif %}
            </td>
            <td class="vs-col">vs</td>
            <td class="score-col">
              {% if m.winner == m.away_team %}
                <strong>{{ m.away_score }}</strong>
              {% else %}
                <span>{{ m.away_score }}</span>
              {% endif %}
            </td>
            <td class="name-col">
              <div class="team-cell-away">
                <span>{{ m.away_team }}{% if m.away_record %}<span class="muted">({{ m.away_record }})</span>{% endif %}</span>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      
      <!-- Mobile Scores Layout -->
      <div class="mobile-scores">
        {% for m in scoreboard %}
        <div class="mobile-score-card">
          <div class="mobile-score-teams">
            <div class="mobile-team">
              <div class="mobile-team-name">{{ m.home_team }}</div>
              {% if m.home_record %}<div class="mobile-team-record">{{ m.home_record }}</div>{% endif %}
              <div class="mobile-score {% if m.winner != m.home_team %}loser{% endif %}">
                {% if m.winner == m.home_team %}<strong>{{ m.home_score }}</strong>{% else %}{{ m.home_score }}{% endif %}
              </div>
            </div>
            <div class="mobile-vs">vs</div>
            <div class="mobile-team">
              <div class="mobile-team-name">{{ m.away_team }}</div>
              {% if m.away_record %}<div class="mobile-team-record">{{ m.away_record }}</div>{% endif %}
              <div class="mobile-score {% if m.winner != m.away_team %}loser{% endif %}">
                {% if m.winner == m.away_team %}<strong>{{ m.away_score }}</strong>{% else %}{{ m.away_score }}{% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- Left: Booms/Busts only -->
    <aside class="card" style="grid-column: 1; grid-row: 3;">
      <h2>Top Booms &amp; Busts by Position</h2>
      <div class="bb-grid">
            {% for row in incentives.boom_bust_by_position %}
        <div class="bb-position-card">
          <div class="bb-position-header">{{ row.position }}</div>
          <div class="bb-players">
            <div class="bb-player boom">
                  {% if row.boom %}
                <div class="bb-player-header">
                  <span class="bb-player-type">Boom</span>
                      </div>
                <div class="bb-player-content">
                  <div class="bb-player-name">{{ row.boom.player_name }}</div>
                  <div class="bb-player-team">{{ row.boom.fantasy_team }}</div>
                  <div class="bb-player-points">{{ row.boom.points }} pts</div>
                    </div>
                {% if row.boom.nfl_logo %}
                  <img class="bb-nfl-logo" src="{{ row.boom.nfl_logo }}" alt="{{ row.boom.nfl_team }} logo" />
                {% endif %}
                  {% else %}
                <div class="bb-player-header">
                  <span class="bb-player-type">Boom</span>
                </div>
                <div class="bb-player-content">
                  <div class="bb-player-name muted">No boom</div>
                  <div class="bb-player-team muted">—</div>
                  <div class="bb-player-points muted">—</div>
                </div>
                  {% endif %}
            </div>
            
            <div class="bb-player bust">
                  {% if row.bust %}
                <div class="bb-player-header">
                  <span class="bb-player-type">Bust</span>
                      </div>
                <div class="bb-player-content">
                  <div class="bb-player-name">{{ row.bust.player_name }}</div>
                  <div class="bb-player-team">{{ row.bust.fantasy_team }}</div>
                  <div class="bb-player-points">{{ row.bust.points }} pts</div>
                    </div>
                {% if row.bust.nfl_logo %}
                  <img class="bb-nfl-logo" src="{{ row.bust.nfl_logo }}" alt="{{ row.bust.nfl_team }} logo" />
                {% endif %}
                  {% else %}
                <div class="bb-player-header">
                  <span class="bb-player-type">Bust</span>
                </div>
                <div class="bb-player-content">
                  <div class="bb-player-name muted">No bust</div>
                  <div class="bb-player-team muted">—</div>
                  <div class="bb-player-points muted">—</div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
        {% empty %}
        <div class="bb-no-data">
          <span class="muted">No player data available.</span>
        </div>
        {% endfor %}
      </div>
      
      <!-- Mobile Booms/Busts Layout -->
      <div class="mobile-bb">
        {% for row in incentives.boom_bust_by_position %}
        <div class="mobile-bb-position">
          <div class="mobile-bb-position-title">{{ row.position }}</div>
          <div class="mobile-bb-players">
            <div class="mobile-bb-player">
              {% if row.boom %}
                <div class="mobile-bb-player-name">{{ row.boom.player_name }}</div>
                <div class="mobile-bb-player-team">{{ row.boom.fantasy_team }}</div>
                <div class="mobile-bb-player-points">{{ row.boom.points }}</div>
              {% else %}
                <div class="mobile-bb-player-name">—</div>
                <div class="mobile-bb-player-team">No boom</div>
                <div class="mobile-bb-player-points">—</div>
              {% endif %}
            </div>
            <div class="mobile-bb-player bust">
              {% if row.bust %}
                <div class="mobile-bb-player-name">{{ row.bust.player_name }}</div>
                <div class="mobile-bb-player-team">{{ row.bust.fantasy_team }}</div>
                <div class="mobile-bb-player-points">{{ row.bust.points }}</div>
              {% else %}
                <div class="mobile-bb-player-name">—</div>
                <div class="mobile-bb-player-team">No bust</div>
                <div class="mobile-bb-player-points">—</div>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </aside>

    <!-- Right: Standings only -->
    <aside class="card" style="grid-column: 3; grid-row: 3;">
      <h2>Standings</h2>
      
      <!-- Desktop Standings - Card Layout -->
      <div class="desktop-standings">
        {% for t in standings %}
        <div class="standing-team-card {% if t.rank <= playoff_team_count %}playoff{% endif %} {% if t.rank == playoff_team_count %}cutoff{% endif %}">
          <div class="standing-rank">
            <div class="rank-number">#{{ t.rank }}</div>
            {% if t.rank <= playoff_team_count %}
              <div class="playoff-badge">🏆</div>
            {% endif %}
          </div>
          
          <div class="standing-team-info">
            <div class="team-name">{{ t.team_name }}</div>
            {% if t.movement_abs %}
              <div class="movement-indicator {% if t.movement_is_up %}up{% else %}down{% endif %}">
                {% if t.movement_is_up %}▲{% else %}▼{% endif %} {{ t.movement_abs }}
              </div>
            {% endif %}
          </div>
          
          <div class="standing-stats">
            <div class="record-badge">{{ t.wins }}-{{ t.losses }}-{{ t.ties }}</div>
            <div class="points-display">{{ t.points_for }}</div>
          </div>
        </div>
        {% endfor %}
      </div>
      
      <!-- Legacy table for fallback -->
      <table class="standings" style="display: none;">
        <thead>
          <tr><th>Team</th><th>W-L-T</th><th>PF</th></tr>
        </thead>
        <tbody>
          {% for t in standings %}
          <tr class="{% if t.rank <= playoff_team_count %}playoff {% endif %}{% if t.rank == playoff_team_count %}cutoff{% endif %}">
            <td>
              <span>{{ t.team_name }}</span>
              {% if t.movement_abs %}
                {% if t.movement_is_up %}
                  <span class="move up">▲ {{ t.movement_abs }}</span>
                {% else %}
                  <span class="move down">▼ {{ t.movement_abs }}</span>
                {% endif %}
                  {% endif %}
                </td>
            <td>{{ t.wins }}-{{ t.losses }}-{{ t.ties }}</td>
            <td>{{ t.points_for }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      
      <!-- Mobile Standings Layout -->
      <div class="mobile-standings">
        {% for t in standings %}
        <div class="mobile-standing-item {% if t.rank <= playoff_team_count %}playoff{% endif %} {% if t.rank == playoff_team_count %}cutoff{% endif %}">
          <div class="mobile-standing-rank">#{{ t.rank }}</div>
          <div class="mobile-standing-team">
            {{ t.team_name }}
            {% if t.movement_abs %}
              {% if t.movement_is_up %}
                <span class="move up">▲ {{ t.movement_abs }}</span>
              {% else %}
                <span class="move down">▼ {{ t.movement_abs }}</span>
              {% endif %}
            {% endif %}
      </div>
          <div class="mobile-standing-stats">
            <div class="mobile-standing-record">{{ t.wins }}-{{ t.losses }}-{{ t.ties }}</div>
            <div class="mobile-standing-pf">{{ t.points_for }}</div>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="muted" style="margin-top:6px;">Top {{ playoff_team_count }} highlighted as current playoff positions.</div>
    </aside>
    
    <!-- New: Player Highlights Card -->
    <section class="card highlights-card" style="grid-column: 1; grid-row: 4; margin-top: 24px;">
      <h2>⭐ Player Highlights</h2>
        <ul class="awards">
          {% for a in awards %}
            <li class="award">
            <span class="award-icon">⭐</span>
              <div class="award-body">
                <div class="award-title">{{ a.title }}</div>
                <div class="award-text">{{ a.text }}</div>
              </div>
            </li>
          {% empty %}
          <li class="muted">No highlights available.</li>
          {% endfor %}
        </ul>
    </section>
    
    <!-- New: Weekly Incentive Card (prominent placement) -->
    <section class="card incentive-card" style="grid-column: 2 / -1; grid-row: 4; margin-top: 24px;">
      <h2>🏆 Weekly Incentive Challenge</h2>
      <div class="incentive-content">
        <div class="incentive-section">
          <div class="incentive-label">This Week's Challenge</div>
          <div class="incentive-title">{{ weekly_incentive.this_title }}</div>
      </div>
        
        <div class="incentive-section">
          <div class="incentive-label">🏅 Winner</div>
          <div class="incentive-winner">
            {% if weekly_incentive.winner_text %}
              <span class="winner-text">{{ weekly_incentive.winner_text }}</span>
            {% else %}
              <span class="pending-text">TBD - Check back after the games!</span>
            {% endif %}
          </div>
        </div>
        
        <div class="incentive-section">
          <div class="incentive-label">🎯 Next Week's Challenge</div>
          <div class="incentive-next">{{ weekly_incentive.next_title }}</div>
        </div>
      </div>
    </section>


  </div>
  <script>
    (function() {
      const overviewEndpoint = "{% url 'weekly_report_overview_api' year=year week=week %}";
      function setText(id, text) {
        const el = document.getElementById(id);
        if (el) { el.textContent = text || ''; }
      }
      function hideSpinner(id) {
        const spinner = document.getElementById(id);
        if (spinner) { spinner.classList.add('hidden'); }
      }
      function showError(id, spinnerId, msg) {
        hideSpinner(spinnerId);
        const el = document.getElementById(id);
        if (el) { el.innerHTML = `<span class="loading">${msg}</span>`; }
      }
      // Fetch smaller chunks in parallel
      function poll(endpoint, onOk, onError) {
        fetch(endpoint)
          .then(r => {
            if (r.status === 202) throw new Error('pending');
            if (!r.ok) throw new Error('error');
            return r.json();
          })
          .then(onOk)
          .catch(() => {
            onError();
            setTimeout(() => poll(endpoint, onOk, onError), 4000);
          });
      }

      poll(overviewEndpoint, (d) => {
        setText('overview', d.overview || '');
        hideSpinner('overview-spinner');
      }, () => {
        showError('overview', 'overview-spinner', 'Overview is taking longer than usual…');
      });

      function sizeWeeklyScores() {
        const card = document.getElementById('scores-card');
        const table = document.getElementById('scores-table');
        if (!card || !table) return;
        // Compute available height beneath the header inside the card
        const cardRect = card.getBoundingClientRect();
        const tableRect = table.getBoundingClientRect();
        const available = Math.max(0, cardRect.height - (tableRect.top - cardRect.top) - 8);
        table.style.height = available + 'px';

        const rows = table.querySelectorAll('tbody > tr');
        if (rows.length > 0) {
          const per = Math.max(48, Math.floor(available / rows.length));
          rows.forEach(r => { r.style.height = per + 'px'; });
        }
      }
      window.addEventListener('resize', sizeWeeklyScores);
      // Defer to next frame so layout is stable
      requestAnimationFrame(sizeWeeklyScores);

      // Simple tabs in left aside
      const tabButtons = document.querySelectorAll('.tab-btn');
      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.getAttribute('data-tab');
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
          const target = document.getElementById(`tab-${tab}`);
          if (target) target.classList.add('active');
        });
      });
    })();
  </script>
</body>
</html>
